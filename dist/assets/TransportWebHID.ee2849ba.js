import{dn as re,w as te,de as ne,dp as F}from"./index.dc867373.js";var ae=globalThis&&globalThis.__values||function(e){var n=typeof Symbol=="function"&&Symbol.iterator,r=n&&e[n],a=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},W={},V={},M=function(e,n){V[e]=n},s=function(e){var n=function(a,o){Object.assign(this,o),this.name=e,this.message=a||e,this.stack=new Error().stack};return n.prototype=new Error,W[e]=n,n},X=function(e){if(typeof e=="object"&&e){try{var n=JSON.parse(e.message);n.message&&n.name&&(e=n)}catch{}var r=void 0;if(typeof e.name=="string"){var a=e.name,o=V[a];if(o)r=o(e);else{var t=a==="Error"?Error:W[a];t||(console.warn("deserializing an unknown class '"+a+"'"),t=s(a)),r=Object.create(t.prototype);try{for(var c in e)e.hasOwnProperty(c)&&(r[c]=e[c])}catch{}}}else r=new Error(e.message);return!r.stack&&Error.captureStackTrace&&Error.captureStackTrace(r,X),r}return new Error(String(e))},oe=function(e){return e&&(typeof e=="object"?K(e,[]):typeof e=="function"?"[Function: "+(e.name||"anonymous")+"]":e)};function K(e,n){var r,a,o={};n.push(e);try{for(var t=ae(Object.keys(e)),c=t.next();!c.done;c=t.next()){var l=c.value,u=e[l];if(typeof u!="function"){if(!u||typeof u!="object"){o[l]=u;continue}if(n.indexOf(e[l])===-1){o[l]=K(e[l],n.slice(0));continue}o[l]="[Circular]"}}}catch(i){r={error:i}}finally{try{c&&!c.done&&(a=t.return)&&a.call(t)}finally{if(r)throw r.error}}return typeof e.name=="string"&&(o.name=e.name),typeof e.message=="string"&&(o.message=e.message),typeof e.stack=="string"&&(o.stack=e.stack),o}var ie=s("AccountNameRequired"),se=s("AccountNotSupported"),ce=s("AmountRequired"),ue=s("BluetoothRequired"),le=s("BtcUnmatchedApp"),de=s("CantOpenDevice"),ve=s("CashAddrNotSupported"),fe=s("CurrencyNotSupported"),pe=s("DeviceAppVerifyNotSupported"),he=s("DeviceGenuineSocketEarlyClose"),ge=s("DeviceNotGenuine"),Ee=s("DeviceOnDashboardExpected"),ye=s("DeviceOnDashboardUnexpected"),me=s("DeviceInOSUExpected"),Ae=s("DeviceHalted"),Te=s("DeviceNameInvalid"),be=s("DeviceSocketFail"),Ie=s("DeviceSocketNoBulkStatus"),Y=s("DisconnectedDevice"),$=s("DisconnectedDeviceDuringOperation"),Se=s("EnpointConfig"),De=s("EthAppPleaseEnableContractData"),we=s("FeeEstimationFailed"),Ne=s("FirmwareNotRecognized"),xe=s("HardResetFail"),Ce=s("InvalidXRPTag"),Ue=s("InvalidAddress"),Re=s("InvalidAddressBecauseDestinationIsAlsoSource"),_e=s("LatestMCUInstalledError"),Oe=s("UnknownMCU"),Be=s("LedgerAPIError"),Pe=s("LedgerAPIErrorWithMessage"),Me=s("LedgerAPINotAvailable"),Le=s("ManagerAppAlreadyInstalled"),Fe=s("ManagerAppRelyOnBTC"),ke=s("ManagerAppDepInstallRequired"),qe=s("ManagerAppDepUninstallRequired"),Ge=s("ManagerDeviceLocked"),ze=s("ManagerFirmwareNotEnoughSpace"),He=s("ManagerNotEnoughSpace"),We=s("ManagerUninstallBTCDep"),Ve=s("NetworkDown"),Xe=s("NoAddressesFound"),Ke=s("NotEnoughBalance"),Ye=s("NotEnoughBalanceToDelegate"),$e=s("NotEnoughBalanceInParentAccount"),je=s("NotEnoughSpendableBalance"),Qe=s("NotEnoughBalanceBecauseDestinationNotCreated"),Je=s("NoAccessToCamera"),Ze=s("NotEnoughGas"),er=s("NotSupportedLegacyAddress"),rr=s("GasLessThanEstimate"),tr=s("PasswordsDontMatch"),nr=s("PasswordIncorrect"),ar=s("RecommendSubAccountsToEmpty"),or=s("RecommendUndelegation"),ir=s("TimeoutTagged"),sr=s("UnexpectedBootloader"),cr=s("MCUNotGenuineToDashboard"),ur=s("RecipientRequired"),lr=s("UnavailableTezosOriginatedAccountReceive"),dr=s("UnavailableTezosOriginatedAccountSend"),vr=s("UpdateFetchFileFail"),fr=s("UpdateIncorrectHash"),pr=s("UpdateIncorrectSig"),hr=s("UpdateYourApp"),gr=s("UserRefusedDeviceNameChange"),Er=s("UserRefusedAddress"),yr=s("UserRefusedFirmwareUpdate"),mr=s("UserRefusedAllowManager"),Ar=s("UserRefusedOnDevice"),_=s("TransportOpenUserCancelled"),Tr=s("TransportInterfaceNotAvailable"),j=s("TransportRaceCondition"),br=s("TransportWebUSBGestureRequired"),Ir=s("DeviceShouldStayInApp"),Sr=s("WebsocketConnectionError"),Dr=s("WebsocketConnectionFailed"),wr=s("WrongDeviceForAccount"),Nr=s("WrongAppForCurrency"),xr=s("ETHAddressNonEIP"),Cr=s("CantScanQRCode"),Ur=s("FeeNotLoaded"),Rr=s("FeeRequired"),_r=s("FeeTooHigh"),Or=s("SyncError"),Br=s("PairingFailed"),Pr=s("GenuineCheckFailed"),Mr=s("LedgerAPI4xx"),Lr=s("LedgerAPI5xx"),Fr=s("FirmwareOrAppUpdateRequired"),kr=s("NoDBPathGiven"),qr=s("DBWrongPassword"),Gr=s("DBNotReset");function A(e,n){this.name="TransportError",this.message=e,this.stack=new Error().stack,this.id=n}A.prototype=new Error;M("TransportError",function(e){return new A(e.message,e.id)});var D={PIN_REMAINING_ATTEMPTS:25536,INCORRECT_LENGTH:26368,MISSING_CRITICAL_PARAMETER:26624,COMMAND_INCOMPATIBLE_FILE_STRUCTURE:27009,SECURITY_STATUS_NOT_SATISFIED:27010,CONDITIONS_OF_USE_NOT_SATISFIED:27013,INCORRECT_DATA:27264,NOT_ENOUGH_MEMORY_SPACE:27268,REFERENCED_DATA_NOT_FOUND:27272,FILE_ALREADY_EXISTS:27273,INCORRECT_P1_P2:27392,INS_NOT_SUPPORTED:27904,CLA_NOT_SUPPORTED:28160,TECHNICAL_PROBLEM:28416,OK:36864,MEMORY_PROBLEM:37440,NO_EF_SELECTED:37888,INVALID_OFFSET:37890,FILE_NOT_FOUND:37892,INCONSISTENT_FILE:37896,ALGORITHM_NOT_SUPPORTED:38020,INVALID_KCV:38021,CODE_NOT_INITIALIZED:38914,ACCESS_CONDITION_NOT_FULFILLED:38916,CONTRADICTION_SECRET_CODE_STATUS:38920,CONTRADICTION_INVALIDATION:38928,CODE_BLOCKED:38976,MAX_VALUE_REACHED:38992,GP_AUTH_FAILED:25344,LICENSING:28482,HALTED:28586};function Q(e){switch(e){case 26368:return"Incorrect length";case 26624:return"Missing critical parameter";case 27010:return"Security not satisfied (dongle locked or have invalid access rights)";case 27013:return"Condition of use not satisfied (denied by the user?)";case 27264:return"Invalid data received";case 27392:return"Invalid parameter received"}if(28416<=e&&e<=28671)return"Internal error, please report"}function N(e){this.name="TransportStatusError";var n=Object.keys(D).find(function(o){return D[o]===e})||"UNKNOWN_ERROR",r=Q(e)||n,a=e.toString(16);this.message="Ledger device: "+r+" (0x"+a+")",this.stack=new Error().stack,this.statusCode=e,this.statusText=n}N.prototype=new Error;M("TransportStatusError",function(e){return new N(e.statusCode)});var zr=Object.freeze(Object.defineProperty({__proto__:null,serializeError:oe,deserializeError:X,createCustomErrorClass:s,addCustomErrorDeserializer:M,AccountNameRequiredError:ie,AccountNotSupported:se,AmountRequired:ce,BluetoothRequired:ue,BtcUnmatchedApp:le,CantOpenDevice:de,CashAddrNotSupported:ve,CurrencyNotSupported:fe,DeviceAppVerifyNotSupported:pe,DeviceGenuineSocketEarlyClose:he,DeviceNotGenuineError:ge,DeviceOnDashboardExpected:Ee,DeviceOnDashboardUnexpected:ye,DeviceInOSUExpected:me,DeviceHalted:Ae,DeviceNameInvalid:Te,DeviceSocketFail:be,DeviceSocketNoBulkStatus:Ie,DisconnectedDevice:Y,DisconnectedDeviceDuringOperation:$,EnpointConfigError:Se,EthAppPleaseEnableContractData:De,FeeEstimationFailed:we,FirmwareNotRecognized:Ne,HardResetFail:xe,InvalidXRPTag:Ce,InvalidAddress:Ue,InvalidAddressBecauseDestinationIsAlsoSource:Re,LatestMCUInstalledError:_e,UnknownMCU:Oe,LedgerAPIError:Be,LedgerAPIErrorWithMessage:Pe,LedgerAPINotAvailable:Me,ManagerAppAlreadyInstalledError:Le,ManagerAppRelyOnBTCError:Fe,ManagerAppDepInstallRequired:ke,ManagerAppDepUninstallRequired:qe,ManagerDeviceLockedError:Ge,ManagerFirmwareNotEnoughSpaceError:ze,ManagerNotEnoughSpaceError:He,ManagerUninstallBTCDep:We,NetworkDown:Ve,NoAddressesFound:Xe,NotEnoughBalance:Ke,NotEnoughBalanceToDelegate:Ye,NotEnoughBalanceInParentAccount:$e,NotEnoughSpendableBalance:je,NotEnoughBalanceBecauseDestinationNotCreated:Qe,NoAccessToCamera:Je,NotEnoughGas:Ze,NotSupportedLegacyAddress:er,GasLessThanEstimate:rr,PasswordsDontMatchError:tr,PasswordIncorrectError:nr,RecommendSubAccountsToEmpty:ar,RecommendUndelegation:or,TimeoutTagged:ir,UnexpectedBootloader:sr,MCUNotGenuineToDashboard:cr,RecipientRequired:ur,UnavailableTezosOriginatedAccountReceive:lr,UnavailableTezosOriginatedAccountSend:dr,UpdateFetchFileFail:vr,UpdateIncorrectHash:fr,UpdateIncorrectSig:pr,UpdateYourApp:hr,UserRefusedDeviceNameChange:gr,UserRefusedAddress:Er,UserRefusedFirmwareUpdate:yr,UserRefusedAllowManager:mr,UserRefusedOnDevice:Ar,TransportOpenUserCancelled:_,TransportInterfaceNotAvailable:Tr,TransportRaceCondition:j,TransportWebUSBGestureRequired:br,DeviceShouldStayInApp:Ir,WebsocketConnectionError:Sr,WebsocketConnectionFailed:Dr,WrongDeviceForAccount:wr,WrongAppForCurrency:Nr,ETHAddressNonEIP:xr,CantScanQRCode:Cr,FeeNotLoaded:Ur,FeeRequired:Rr,FeeTooHigh:_r,SyncError:Or,PairingFailed:Br,GenuineCheckFailed:Pr,LedgerAPI4xx:Mr,LedgerAPI5xx:Lr,FirmwareOrAppUpdateRequired:Fr,NoDBPathGiven:kr,DBWrongPassword:qr,DBNotReset:Gr,TransportError:A,StatusCodes:D,getAltStatusMessage:Q,TransportStatusError:N},Symbol.toStringTag,{value:"Module"})),x=globalThis&&globalThis.__awaiter||function(e,n,r,a){function o(t){return t instanceof r?t:new r(function(c){c(t)})}return new(r||(r=Promise))(function(t,c){function l(d){try{i(a.next(d))}catch(v){c(v)}}function u(d){try{i(a.throw(d))}catch(v){c(v)}}function i(d){d.done?t(d.value):o(d.value).then(l,u)}i((a=a.apply(e,n||[])).next())})},C=globalThis&&globalThis.__generator||function(e,n){var r={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},a,o,t,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(i){return function(d){return u([i,d])}}function u(i){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,o&&(t=i[0]&2?o.return:i[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,i[1])).done)return t;switch(o=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(t=r.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){r.label=i[1];break}if(i[0]===6&&r.label<t[1]){r.label=t[1],t=i;break}if(t&&r.label<t[2]){r.label=t[2],r.ops.push(i);break}t[2]&&r.ops.pop(),r.trys.pop();continue}i=n.call(e,r)}catch(d){i=[6,d],o=0}finally{a=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Hr=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),o,t=[],c;try{for(;(n===void 0||n-- >0)&&!(o=a.next()).done;)t.push(o.value)}catch(l){c={error:l}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(c)throw c.error}}return t},Wr=globalThis&&globalThis.__spreadArray||function(e,n,r){if(r||arguments.length===2)for(var a=0,o=n.length,t;a<o;a++)(t||!(a in n))&&(t||(t=Array.prototype.slice.call(n,0,a)),t[a]=n[a]);return e.concat(t||Array.prototype.slice.call(n))},Vr=globalThis&&globalThis.__values||function(e){var n=typeof Symbol=="function"&&Symbol.iterator,r=n&&e[n],a=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},Xr=function(){function e(){var n=this;this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new re,this.send=function(r,a,o,t,c,l){return c===void 0&&(c=Buffer.alloc(0)),l===void 0&&(l=[D.OK]),x(n,void 0,void 0,function(){var u,i;return C(this,function(d){switch(d.label){case 0:if(c.length>=256)throw new A("data.length exceed 256 bytes limit. Got: "+c.length,"DataLengthTooBig");return[4,this.exchange(Buffer.concat([Buffer.from([r,a,o,t]),Buffer.from([c.length]),c]))];case 1:if(u=d.sent(),i=u.readUInt16BE(u.length-2),!l.some(function(v){return v===i}))throw new N(i);return[2,u]}})})},this.exchangeAtomicImpl=function(r){return x(n,void 0,void 0,function(){var a,o,t,c,l,u=this;return C(this,function(i){switch(i.label){case 0:if(this.exchangeBusyPromise)throw new j("An action was already pending on the Ledger device. Please deny or reconnect.");o=new Promise(function(d){a=d}),this.exchangeBusyPromise=o,t=!1,c=setTimeout(function(){t=!0,u.emit("unresponsive")},this.unresponsiveTimeout),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,r()];case 2:return l=i.sent(),t&&this.emit("responsive"),[2,l];case 3:return clearTimeout(c),a&&a(),this.exchangeBusyPromise=null,[7];case 4:return[2]}})})},this._appAPIlock=null}return e.prototype.exchange=function(n){throw new Error("exchange not implemented")},e.prototype.setScrambleKey=function(n){},e.prototype.close=function(){return Promise.resolve()},e.prototype.on=function(n,r){this._events.on(n,r)},e.prototype.off=function(n,r){this._events.removeListener(n,r)},e.prototype.emit=function(n){for(var r,a=[],o=1;o<arguments.length;o++)a[o-1]=arguments[o];(r=this._events).emit.apply(r,Wr([n],Hr(a),!1))},e.prototype.setDebugMode=function(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")},e.prototype.setExchangeTimeout=function(n){this.exchangeTimeout=n},e.prototype.setExchangeUnresponsiveTimeout=function(n){this.unresponsiveTimeout=n},e.create=function(n,r){var a=this;return n===void 0&&(n=3e3),new Promise(function(o,t){var c=!1,l=a.listen({next:function(i){c=!0,l&&l.unsubscribe(),u&&clearTimeout(u),a.open(i.descriptor,n).then(o,t)},error:function(i){u&&clearTimeout(u),t(i)},complete:function(){u&&clearTimeout(u),c||t(new A(a.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=r?setTimeout(function(){l.unsubscribe(),t(new A(a.ErrorMessage_ListenTimeout,"ListenTimeout"))},r):null})},e.prototype.decorateAppAPIMethods=function(n,r,a){var o,t;try{for(var c=Vr(r),l=c.next();!l.done;l=c.next()){var u=l.value;n[u]=this.decorateAppAPIMethod(u,n[u],n,a)}}catch(i){o={error:i}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(o)throw o.error}}},e.prototype.decorateAppAPIMethod=function(n,r,a,o){var t=this;return function(){for(var c=[],l=0;l<arguments.length;l++)c[l]=arguments[l];return x(t,void 0,void 0,function(){var u;return C(this,function(i){switch(i.label){case 0:if(u=this._appAPIlock,u)return[2,Promise.reject(new A("Ledger Device is busy (lock "+u+")","TransportLocked"))];i.label=1;case 1:return i.trys.push([1,,3,4]),this._appAPIlock=n,this.setScrambleKey(o),[4,r.apply(a,c)];case 2:return[2,i.sent()];case 3:return this._appAPIlock=null,[7];case 4:return[2]}})})}},e.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",e.ErrorMessage_NoDeviceFound="No Ledger device found",e}(),J={},Kr=te(zr);(function(e){e.__esModule=!0;var n=Kr,r=5;function a(c){var l=Buffer.alloc(2);return l.writeUInt16BE(c,0),l}var o={data:Buffer.alloc(0),dataLength:0,sequence:0},t=function(c,l){return{makeBlocks:function(u){var i=Buffer.concat([a(u.length),u]),d=l-5,v=Math.ceil(i.length/d);i=Buffer.concat([i,Buffer.alloc(v*d-i.length+1).fill(0)]);for(var h=[],f=0;f<v;f++){var g=Buffer.alloc(5);g.writeUInt16BE(c,0),g.writeUInt8(r,2),g.writeUInt16BE(f,3);var b=i.slice(f*d,(f+1)*d);h.push(Buffer.concat([g,b]))}return h},reduceResponse:function(u,i){var d=u||o,v=d.data,h=d.dataLength,f=d.sequence;if(i.readUInt16BE(0)!==c)throw new n.TransportError("Invalid channel","InvalidChannel");if(i.readUInt8(2)!==r)throw new n.TransportError("Invalid tag","InvalidTag");if(i.readUInt16BE(3)!==f)throw new n.TransportError("Invalid sequence","InvalidSequence");u||(h=i.readUInt16BE(5)),f++;var g=i.slice(u?5:7);return v=Buffer.concat([v,g]),v.length>h&&(v=v.slice(0,h)),{data:v,dataLength:h,sequence:f}},getReducedResult:function(u){if(u&&u.dataLength===u.data.length)return u.data}}};e.default=t})(J);var Yr=ne(J),O=globalThis&&globalThis.__assign||function(){return O=Object.assign||function(e){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},O.apply(this,arguments)},T,p;(function(e){e.blue="blue",e.nanoS="nanoS",e.nanoSP="nanoSP",e.nanoX="nanoX"})(p||(p={}));var B=(T={},T[p.blue]={id:p.blue,productName:"Ledger\xA0Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:function(e){return 4*1024}},T[p.nanoS]={id:p.nanoS,productName:"Ledger\xA0Nano\xA0S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:function(e){var n;return F.lt((n=F.coerce(e))!==null&&n!==void 0?n:"","2.0.0")?4*1024:2*1024}},T[p.nanoSP]={id:p.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1533*1024,masks:[856686592],getBlockSize:function(e){return 32}},T[p.nanoX]={id:p.nanoX,productName:"Ledger\xA0Nano\xA0X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:function(e){return 4*1024},bluetoothSpec:[{serviceUuid:"d973f2e0-b19e-11e2-9e96-0800200c9a66",notifyUuid:"d973f2e1-b19e-11e2-9e96-0800200c9a66",writeUuid:"d973f2e2-b19e-11e2-9e96-0800200c9a66",writeCmdUuid:"d973f2e3-b19e-11e2-9e96-0800200c9a66"},{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},T);p.blue,p.nanoS,p.nanoX;var k=Object.values(B),Z=11415,q=function(e){var n=k.find(function(o){return o.legacyUsbProductId===e});if(n)return n;var r=e>>8,a=k.find(function(o){return o.productIdMM===r});return a},$r=[],G={};for(var jr in B){var z=B[jr],U=z.bluetoothSpec;if(U)for(var R=0;R<U.length;R++){var S=U[R];$r.push(S.serviceUuid),G[S.serviceUuid]=G[S.serviceUuid.replace(/-/g,"")]=O({deviceModel:z},S)}}var Qr=0,m=[],H=function(e,n,r){var a={type:e,id:String(++Qr),date:new Date};n&&(a.message=n),r&&(a.data=r),Zr(a)},Jr=function(e){return m.push(e),function(){var n=m.indexOf(e);n!==-1&&(m[n]=m[m.length-1],m.pop())}};function Zr(e){for(var n=0;n<m.length;n++)try{m[n](e)}catch(r){console.error(r)}}typeof window!="undefined"&&(window.__ledgerLogsListen=Jr);var et=globalThis&&globalThis.__extends||function(){var e=function(n,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,o){a.__proto__=o}||function(a,o){for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(a[t]=o[t])},e(n,r)};return function(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(n,r);function a(){this.constructor=n}n.prototype=r===null?Object.create(r):(a.prototype=r.prototype,new a)}}(),E=globalThis&&globalThis.__awaiter||function(e,n,r,a){function o(t){return t instanceof r?t:new r(function(c){c(t)})}return new(r||(r=Promise))(function(t,c){function l(d){try{i(a.next(d))}catch(v){c(v)}}function u(d){try{i(a.throw(d))}catch(v){c(v)}}function i(d){d.done?t(d.value):o(d.value).then(l,u)}i((a=a.apply(e,n||[])).next())})},y=globalThis&&globalThis.__generator||function(e,n){var r={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},a,o,t,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(i){return function(d){return u([i,d])}}function u(i){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,o&&(t=i[0]&2?o.return:i[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,i[1])).done)return t;switch(o=0,t&&(i=[i[0]&2,t.value]),i[0]){case 0:case 1:t=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,o=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(t=r.trys,!(t=t.length>0&&t[t.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!t||i[1]>t[0]&&i[1]<t[3])){r.label=i[1];break}if(i[0]===6&&r.label<t[1]){r.label=t[1],t=i;break}if(t&&r.label<t[2]){r.label=t[2],r.ops.push(i);break}t[2]&&r.ops.pop(),r.trys.pop();continue}i=n.call(e,r)}catch(d){i=[6,d],o=0}finally{a=t=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},rt=globalThis&&globalThis.__read||function(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var a=r.call(e),o,t=[],c;try{for(;(n===void 0||n-- >0)&&!(o=a.next()).done;)t.push(o.value)}catch(l){c={error:l}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(c)throw c.error}}return t},tt=[{vendorId:Z}],nt=function(){return Promise.resolve(!!(window.navigator&&window.navigator.hid))},w=function(){var e=navigator.hid;if(!e)throw new A("navigator.hid is not supported","HIDNotSupported");return e};function ee(){return E(this,void 0,void 0,function(){var e;return y(this,function(n){switch(n.label){case 0:return[4,w().requestDevice({filters:tt})];case 1:return e=n.sent(),Array.isArray(e)?[2,e]:[2,[e]]}})})}function P(){return E(this,void 0,void 0,function(){var e;return y(this,function(n){switch(n.label){case 0:return[4,w().getDevices()];case 1:return e=n.sent(),[2,e.filter(function(r){return r.vendorId===Z})]}})})}function at(){return E(this,void 0,void 0,function(){var e,n;return y(this,function(r){switch(r.label){case 0:return[4,P()];case 1:return e=r.sent(),e.length>0?[2,e[0]]:[4,ee()];case 2:return n=r.sent(),[2,n[0]]}})})}var it=function(e){et(n,e);function n(r){var a=e.call(this)||this;return a.channel=Math.floor(Math.random()*65535),a.packetSize=64,a.inputs=[],a.read=function(){return a.inputs.length?Promise.resolve(a.inputs.shift()):new Promise(function(o){a.inputCallback=o})},a.onInputReport=function(o){var t=Buffer.from(o.data.buffer);a.inputCallback?(a.inputCallback(t),a.inputCallback=null):a.inputs.push(t)},a._disconnectEmitted=!1,a._emitDisconnect=function(o){a._disconnectEmitted||(a._disconnectEmitted=!0,a.emit("disconnect",o))},a.exchange=function(o){return E(a,void 0,void 0,function(){var t,c=this;return y(this,function(l){switch(l.label){case 0:return[4,this.exchangeAtomicImpl(function(){return E(c,void 0,void 0,function(){var u,i,d,v,h,f,g,b,L;return y(this,function(I){switch(I.label){case 0:u=this,i=u.channel,d=u.packetSize,H("apdu","=> "+o.toString("hex")),v=Yr(i,d),h=v.makeBlocks(o),f=0,I.label=1;case 1:return f<h.length?[4,this.device.sendReport(0,h[f])]:[3,4];case 2:I.sent(),I.label=3;case 3:return f++,[3,1];case 4:return(g=v.getReducedResult(b))?[3,6]:[4,this.read()];case 5:return L=I.sent(),b=v.reduceResponse(b,L),[3,4];case 6:return H("apdu","<= "+g.toString("hex")),[2,g]}})})}).catch(function(u){throw u&&u.message&&u.message.includes("write")?(c._emitDisconnect(u),new $(u.message)):u})];case 1:return t=l.sent(),[2,t]}})})},a.device=r,a.deviceModel=typeof r.productId=="number"?q(r.productId):void 0,r.addEventListener("inputreport",a.onInputReport),a}return n.request=function(){return E(this,void 0,void 0,function(){var r,a;return y(this,function(o){switch(o.label){case 0:return[4,ee()];case 1:return r=rt.apply(void 0,[o.sent(),1]),a=r[0],[2,n.open(a)]}})})},n.openConnected=function(){return E(this,void 0,void 0,function(){var r;return y(this,function(a){switch(a.label){case 0:return[4,P()];case 1:return r=a.sent(),r.length===0?[2,null]:[2,n.open(r[0])]}})})},n.open=function(r){return E(this,void 0,void 0,function(){var a,o;return y(this,function(t){switch(t.label){case 0:return[4,r.open()];case 1:return t.sent(),a=new n(r),o=function(c){r===c.device&&(w().removeEventListener("disconnect",o),a._emitDisconnect(new Y))},w().addEventListener("disconnect",o),[2,a]}})})},n.prototype.close=function(){return E(this,void 0,void 0,function(){return y(this,function(r){switch(r.label){case 0:return[4,this.exchangeBusyPromise];case 1:return r.sent(),this.device.removeEventListener("inputreport",this.onInputReport),[4,this.device.close()];case 2:return r.sent(),[2]}})})},n.prototype.setScrambleKey=function(){},n.isSupported=nt,n.list=P,n.listen=function(r){var a=!1;at().then(function(t){if(!t)r.error(new _("Access denied to use Ledger device"));else if(!a){var c=typeof t.productId=="number"?q(t.productId):void 0;r.next({type:"add",descriptor:t,deviceModel:c}),r.complete()}},function(t){r.error(new _(t.message))});function o(){a=!0}return{unsubscribe:o}},n}(Xr);export{it as default};
