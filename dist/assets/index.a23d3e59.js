import{df as A,dg as x}from"./index.dc867373.js";var E={exports:{}};(function(_){var o=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function p(c,e,t){this.fn=c,this.context=e,this.once=t||!1}function u(c,e,t,s,v){if(typeof t!="function")throw new TypeError("The listener must be a function");var f=new p(t,s||c,v),l=n?n+e:e;return c._events[l]?c._events[l].fn?c._events[l]=[c._events[l],f]:c._events[l].push(f):(c._events[l]=f,c._eventsCount++),c}function h(c,e){--c._eventsCount===0?c._events=new r:delete c._events[e]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var e=[],t,s;if(this._eventsCount===0)return e;for(s in t=this._events)o.call(t,s)&&e.push(n?s.slice(1):s);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},a.prototype.listeners=function(e){var t=n?n+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var v=0,f=s.length,l=new Array(f);v<f;v++)l[v]=s[v].fn;return l},a.prototype.listenerCount=function(e){var t=n?n+e:e,s=this._events[t];return s?s.fn?1:s.length:0},a.prototype.emit=function(e,t,s,v,f,l){var w=n?n+e:e;if(!this._events[w])return!1;var i=this._events[w],y=arguments.length,g,d;if(i.fn){switch(i.once&&this.removeListener(e,i.fn,void 0,!0),y){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,t),!0;case 3:return i.fn.call(i.context,t,s),!0;case 4:return i.fn.call(i.context,t,s,v),!0;case 5:return i.fn.call(i.context,t,s,v,f),!0;case 6:return i.fn.call(i.context,t,s,v,f,l),!0}for(d=1,g=new Array(y-1);d<y;d++)g[d-1]=arguments[d];i.fn.apply(i.context,g)}else{var K=i.length,m;for(d=0;d<K;d++)switch(i[d].once&&this.removeListener(e,i[d].fn,void 0,!0),y){case 1:i[d].fn.call(i[d].context);break;case 2:i[d].fn.call(i[d].context,t);break;case 3:i[d].fn.call(i[d].context,t,s);break;case 4:i[d].fn.call(i[d].context,t,s,v);break;default:if(!g)for(m=1,g=new Array(y-1);m<y;m++)g[m-1]=arguments[m];i[d].fn.apply(i[d].context,g)}}return!0},a.prototype.on=function(e,t,s){return u(this,e,t,s,!1)},a.prototype.once=function(e,t,s){return u(this,e,t,s,!0)},a.prototype.removeListener=function(e,t,s,v){var f=n?n+e:e;if(!this._events[f])return this;if(!t)return h(this,f),this;var l=this._events[f];if(l.fn)l.fn===t&&(!v||l.once)&&(!s||l.context===s)&&h(this,f);else{for(var w=0,i=[],y=l.length;w<y;w++)(l[w].fn!==t||v&&!l[w].once||s&&l[w].context!==s)&&i.push(l[w]);i.length?this._events[f]=i.length===1?i[0]:i:h(this,f)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&h(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,_.exports=a})(E);var P=E.exports,b=globalThis&&globalThis.__awaiter||function(_,o,n,r){function p(u){return u instanceof n?u:new n(function(h){h(u)})}return new(n||(n=Promise))(function(u,h){function a(t){try{e(r.next(t))}catch(s){h(s)}}function c(t){try{e(r.throw(t))}catch(s){h(s)}}function e(t){t.done?u(t.value):p(t.value).then(a,c)}e((r=r.apply(_,o||[])).next())})};class R extends P{constructor(o,n){super();if(this._network=n,this._publicKey=null,this._popup=null,this._handlerAdded=!1,this._nextRequestId=1,this._autoApprove=!1,this._responsePromises=new Map,this.handleMessage=r=>{var p;if(this._injectedProvider&&r.source===window||r.origin===((p=this._providerUrl)===null||p===void 0?void 0:p.origin)&&r.source===this._popup){if(r.data.method==="connected"){const u=new A(r.data.params.publicKey);(!this._publicKey||!this._publicKey.equals(u))&&(this._publicKey&&!this._publicKey.equals(u)&&this.handleDisconnect(),this._publicKey=u,this._autoApprove=!!r.data.params.autoApprove,this.emit("connect",this._publicKey))}else if(r.data.method==="disconnected")this.handleDisconnect();else if(r.data.result||r.data.error){const u=this._responsePromises.get(r.data.id);if(u){const[h,a]=u;r.data.result?h(r.data.result):a(new Error(r.data.error))}}}},this._beforeUnload=()=>{this.disconnect()},j(o))this._injectedProvider=o;else if(L(o))this._providerUrl=new URL(o),this._providerUrl.hash=new URLSearchParams({origin:window.location.origin,network:this._network}).toString();else throw new Error("provider parameter must be an injected provider or a URL string.")}handleConnect(){var o;return this._handlerAdded||(this._handlerAdded=!0,window.addEventListener("message",this.handleMessage),window.addEventListener("beforeunload",this._beforeUnload)),this._injectedProvider?new Promise(n=>{this.sendRequest("connect",{}),n()}):(window.name="parent",this._popup=window.open((o=this._providerUrl)===null||o===void 0?void 0:o.toString(),"_blank","location,resizable,width=460,height=675"),new Promise(n=>{this.once("connect",n)}))}handleDisconnect(){this._handlerAdded&&(this._handlerAdded=!1,window.removeEventListener("message",this.handleMessage),window.removeEventListener("beforeunload",this._beforeUnload)),this._publicKey&&(this._publicKey=null,this.emit("disconnect")),this._responsePromises.forEach(([,o],n)=>{this._responsePromises.delete(n),o(new Error("Wallet disconnected"))})}sendRequest(o,n){return b(this,void 0,void 0,function*(){if(o!=="connect"&&!this.connected)throw new Error("Wallet not connected");const r=this._nextRequestId;return++this._nextRequestId,new Promise((p,u)=>{var h,a,c,e;this._responsePromises.set(r,[p,u]),this._injectedProvider?this._injectedProvider.postMessage({jsonrpc:"2.0",id:r,method:o,params:Object.assign({network:this._network},n)}):((h=this._popup)===null||h===void 0||h.postMessage({jsonrpc:"2.0",id:r,method:o,params:n},(c=(a=this._providerUrl)===null||a===void 0?void 0:a.origin)!==null&&c!==void 0?c:""),this.autoApprove||(e=this._popup)===null||e===void 0||e.focus())})})}get publicKey(){return this._publicKey}get connected(){return this._publicKey!==null}get autoApprove(){return this._autoApprove}connect(){return b(this,void 0,void 0,function*(){this._popup&&this._popup.close(),yield this.handleConnect()})}disconnect(){return b(this,void 0,void 0,function*(){this._injectedProvider&&(yield this.sendRequest("disconnect",{})),this._popup&&this._popup.close(),this.handleDisconnect()})}sign(o,n){return b(this,void 0,void 0,function*(){if(!(o instanceof Uint8Array))throw new Error("Data must be an instance of Uint8Array");const r=yield this.sendRequest("sign",{data:o,display:n}),p=x.decode(r.signature),u=new A(r.publicKey);return{signature:p,publicKey:u}})}signTransaction(o){return b(this,void 0,void 0,function*(){const n=yield this.sendRequest("signTransaction",{message:x.encode(o.serializeMessage())}),r=x.decode(n.signature),p=new A(n.publicKey);return o.addSignature(p,r),o})}signAllTransactions(o){return b(this,void 0,void 0,function*(){const n=yield this.sendRequest("signAllTransactions",{messages:o.map(u=>x.encode(u.serializeMessage()))}),r=n.signatures.map(u=>x.decode(u)),p=new A(n.publicKey);return o=o.map((u,h)=>(u.addSignature(p,r[h]),u)),o})}diffieHellman(o){return b(this,void 0,void 0,function*(){if(!(o instanceof Uint8Array))throw new Error("Data must be an instance of Uint8Array");return yield this.sendRequest("diffieHellman",{publicKey:o})})}}function L(_){return typeof _=="string"}function j(_){return U(_)&&"postMessage"in _&&typeof _.postMessage=="function"}function U(_){return typeof _=="object"&&_!==null}export{R as default};
